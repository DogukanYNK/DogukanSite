<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Admin Paneli - DogukanStore</title>

    @* Temel CSS Dosyaları *@
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    @* Ana site.css'i yine de dahil edebiliriz, bazı temel stiller (formlar, butonlar) ortak olabilir *@
    <link rel="stylesheet" href="~/css/core.css" asp-append-version="true" />
    @* Admin Paneline Özel CSS Dosyası *@
    <link rel="stylesheet" href="~/css/admin.css" asp-append-version="true" />

    @await RenderSectionAsync("Styles", required: false)
</head>
<body class="admin-layout-active">

    <header class="admin-header sticky-top bg-dark text-white p-2 shadow-sm">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <a class="navbar-brand text-white fs-5" asp-page="/Admin/Index">DogukanStore Admin</a>
            <button class="btn btn-outline-light d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#adminSidebarOffcanvas" aria-controls="adminSidebarOffcanvas">
                <i class="fas fa-bars"></i>
            </button>
            <div class="d-flex align-items-center">
                @if (User.Identity.IsAuthenticated)
                {
                    <span class="navbar-text me-3">Hoş geldiniz, @User.Identity.Name</span>
                    <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new { area = "" })" method="post" class="d-inline">
                        <button type="submit" class="btn btn-sm btn-outline-light">
                            <i class="fas fa-sign-out-alt me-1"></i>Çıkış Yap
                        </button>
                    </form>
                }
            </div>
        </div>
    </header>

    <div class="admin-wrapper">
        <nav class="admin-sidebar bg-light border-end" id="adminSidebar">
            <div class="pt-3">
                <ul class="nav nav-pills flex-column mb-auto">
                    <li class="nav-item">
                        <a asp-page="/Admin/Index" class="nav-link @IsAdminPageActive("/Admin/Index")">
                            <i class="fas fa-tachometer-alt fa-fw me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-header">İÇERİK YÖNETİMİ</li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageProducts" class="nav-link @IsAdminPageActive("/Admin/ManageProducts", "/Admin/AddProduct", "/Admin/EditProduct")">
                            <i class="fas fa-box-open fa-fw me-2"></i>Ürünler
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageCategories" class="nav-link @IsAdminPageActive("/Admin/ManageCategories", "/Admin/AddCategory", "/Admin/EditCategory")">
                            <i class="fas fa-sitemap fa-fw me-2"></i>Kategoriler
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageBanners" class="nav-link @IsAdminPageActive("/Admin/ManageBanners")">
                            <i class="fas fa-images fa-fw me-2"></i>Banner/Slider
                        </a>
                    </li>

                    <li class="nav-header">SATIŞ YÖNETİMİ</li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageOrders" class="nav-link @IsAdminPageActive("/Admin/ManageOrders", "/Admin/OrderDetails")">
                            <i class="fas fa-receipt fa-fw me-2"></i>Siparişler
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageCustomers" class="nav-link @IsAdminPageActive("/Admin/ManageCustomers")">
                            <i class="fas fa-users fa-fw me-2"></i>Müşteriler
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageCoupons" class="nav-link @IsAdminPageActive("/Admin/ManageCoupons")">
                            <i class="fas fa-tags fa-fw me-2"></i>İndirim Kuponları
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageCampaigns" class="nav-link @IsAdminPageActive("/Admin/ManageCampaigns")">
                            <i class="fas fa-bullhorn fa-fw me-2"></i>Kampanyalar
                        </a>
                    </li>

                    <li class="nav-header">RAPORLAMA</li>
                    <li class="nav-item">
                        <a asp-page="/Admin/Reports/Sales" class="nav-link @IsAdminPageActive("/Admin/Reports/Sales")">
                            @* Örnek bir rapor sayfası *@
                            <i class="fas fa-chart-line fa-fw me-2"></i>Satış Raporları
                        </a>
                    </li>

                    <li class="nav-header mt-auto pt-3">SİTE</li>
                    <li class="nav-item">
                        <a asp-page="/Index" target="_blank" class="nav-link">
                            <i class="fas fa-external-link-alt fa-fw me-2"></i>Siteyi Görüntüle
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        @* Mobil için Offcanvas Sidebar *@
        <div class="offcanvas offcanvas-start bg-light border-end" tabindex="-1" id="adminSidebarOffcanvas" aria-labelledby="adminSidebarOffcanvasLabel">
            <div class="offcanvas-header border-bottom">
                <h5 class="offcanvas-title" id="adminSidebarOffcanvasLabel">Admin Menü</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                @* Sidebar içeriğini buraya kopyalayabilir veya partial ile çekebilirsiniz *@
                <ul class="nav nav-pills flex-column mb-auto">
                    <li class="nav-item">
                        <a asp-page="/Admin/Index" class="nav-link @IsAdminPageActive("/Admin/Index")">
                            <i class="fas fa-tachometer-alt fa-fw me-2"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-header">İÇERİK YÖNETİMİ</li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageProducts" class="nav-link @IsAdminPageActive("/Admin/ManageProducts", "/Admin/AddProduct", "/Admin/EditProduct")">
                            <i class="fas fa-box-open fa-fw me-2"></i>Ürünler
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageCategories" class="nav-link @IsAdminPageActive("/Admin/ManageCategories", "/Admin/AddCategory", "/Admin/EditCategory")">
                            <i class="fas fa-sitemap fa-fw me-2"></i>Kategoriler
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageBanners" class="nav-link @IsAdminPageActive("/Admin/ManageBanners")">
                            <i class="fas fa-images fa-fw me-2"></i>Banner/Slider
                        </a>
                    </li>
                    <li class="nav-header">SATIŞ YÖNETİMİ</li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageOrders" class="nav-link @IsAdminPageActive("/Admin/ManageOrders", "/Admin/OrderDetails")">
                            <i class="fas fa-receipt fa-fw me-2"></i>Siparişler
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageCustomers" class="nav-link @IsAdminPageActive("/Admin/ManageCustomers")">
                            <i class="fas fa-users fa-fw me-2"></i>Müşteriler
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageCoupons" class="nav-link @IsAdminPageActive("/Admin/ManageCoupons")">
                            <i class="fas fa-tags fa-fw me-2"></i>İndirim Kuponları
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-page="/Admin/ManageCampaigns" class="nav-link @IsAdminPageActive("/Admin/ManageCampaigns")">
                            <i class="fas fa-bullhorn fa-fw me-2"></i>Kampanyalar
                        </a>
                    </li>
                    <li class="nav-header">RAPORLAMA</li>
                    <li class="nav-item">
                        <a asp-page="/Admin/Reports/Sales" class="nav-link @IsAdminPageActive("/Admin/Reports/Sales")">
                            <i class="fas fa-chart-line fa-fw me-2"></i>Satış Raporları
                        </a>
                    </li>
                    <li class="nav-header mt-auto pt-3">SİTE</li>
                    <li class="nav-item">
                        <a asp-page="/Index" target="_blank" class="nav-link">
                            <i class="fas fa-external-link-alt fa-fw me-2"></i>Siteyi Görüntüle
                        </a>
                    </li>
                </ul>
            </div>
        </div>


        <main role="main" class="admin-main-content">
            <div class="container-fluid p-4">
                @* İçerik için padding *@
                @RenderBody()
            </div>
        </main>
    </div>

    @* Temel JS Dosyaları *@
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    @* Admin paneline özel JS dosyası (gerekirse) *@
    @* <script src="~/js/admin.js" asp-append-version="true"></script> *@
    <script src="~/js/site.js" asp-append-version="true"></script> @* Ana site.js'i de dahil edebiliriz *@

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

@functions {
    // Admin navigasyon linklerine dinamik olarak 'active' sınıfını ekler.
    // Birden fazla sayfa için aktiflik kontrolü yapar (örn: ManageProducts, AddProduct, EditProduct hepsi "Ürünler" linkini aktif yapar)
    public string IsAdminPageActive(params string[] pageUrls)
    {
        var activePage = ViewContext.RouteData.Values["page"]?.ToString();
        if (activePage != null && pageUrls.Any(url => activePage.Equals(url, StringComparison.OrdinalIgnoreCase) || activePage.StartsWith(url + "/", StringComparison.OrdinalIgnoreCase)))
        {
            return "active text-primary fw-semibold"; // Bootstrap 'active' sınıfı ve ek vurgu
        }
        return "text-dark"; // Varsayılan link rengi
    }
}